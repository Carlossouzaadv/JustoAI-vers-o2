‚óè ‚úÖ CONFIRMA√á√ÉO: O QUE FUNCIONA SEM JUDIT API KEY

  Fluxo de Upload de Processo (An√°lise Detalhada)

  Seu pipeline tem 8 passos principais. Aqui est√£o os que funcionam 100% sem JUDIT:

  | Passo | Descri√ß√£o                              | Depende de JUDIT? | Status     |
  |-------|----------------------------------------|-------------------|------------|
  | 1Ô∏è‚É£   | Upload PDF + valida√ß√µes                | ‚ùå N√ÉO             | ‚úÖ FUNCIONA |
  | 2Ô∏è‚É£   | Extra√ß√£o de texto do PDF               | ‚ùå N√ÉO             | ‚úÖ FUNCIONA |
  | 3Ô∏è‚É£   | Limpeza + normaliza√ß√£o de texto        | ‚ùå N√ÉO             | ‚úÖ FUNCIONA |
  | 4Ô∏è‚É£   | Detec√ß√£o de CNJ (regex)                | ‚ùå N√ÉO             | ‚úÖ FUNCIONA |
  | 5Ô∏è‚É£   | Cria√ß√£o de Case no BD                  | ‚ùå N√ÉO             | ‚úÖ FUNCIONA |
  | 6Ô∏è‚É£   | Upload para Supabase Storage           | ‚ùå N√ÉO             | ‚úÖ FUNCIONA |
  | 7Ô∏è‚É£   | ü§ñ GEMINI PREVIEW (Phase 1)            | ‚ùå N√ÉO             | ‚úÖ FUNCIONA |
  | 8Ô∏è‚É£   | Merge Timeline + Attachments (Phase 2) | ‚úÖ SIM             | ‚ùå PUL√ÅVEL  |

  ---
  üéØ O QUE VOC√ä CONSEGUE FAZER AGORA:

  Sem JUDIT, o upload retorna:

  {
    "success": true,
    "caseId": "uuid",
    "caseNumber": "0000000-00.0000.0.00.0000",
    "status": "previewed",
    "detectedCnj": "0000000-00.0000.0.00.0000",
    "preview": {
      "summary": "Resumo completo do processo...",
      "parties": {
        "author": "Nome da parte autora",
        "defendant": "Nome da parte r√©"
      },
      "subject": "Descri√ß√£o do objeto do processo",
      "claimValue": 50000.00,
      "lastMovements": [
        {
          "type": "Senten√ßa",
          "date": "2025-01-15",
          "description": "Descri√ß√£o do movimento"
        }
      ],
      "riskClassification": "M√âDIO",
      "keyPoints": ["Ponto 1", "Ponto 2", "Ponto 3"],
      "model": "gemini-2.5-flash"
    },
    "analysisModel": "gemini-2.5-flash",
    "juditJobId": null,  // ‚Üê NULO sem JUDIT
    "timing": {
      "total": 8000,
      "extraction": 1200,
      "preview": 6800
    },
    "message": "Preview gerado com sucesso! (JUDIT skipped)"
  }

  ---
  üìã INFORMA√á√ïES EXTRA√çDAS PELO GEMINI (SEM JUDIT):

  Baseado no c√≥digo da preview analysis service e system prompts, o Gemini extrai:

  Se√ß√£o A: Identifica√ß√£o B√°sica

  - ‚úÖ N√∫mero do processo (detectado via regex)
  - ‚úÖ Tipo processual (Civil, Criminal, Trabalhista)
  - ‚úÖ Esfera (Federal/Estadual/Municipal)
  - ‚úÖ √ìrg√£o/Inst√¢ncia
  - ‚úÖ Comarca
  - ‚úÖ Vara
  - ‚úÖ Juiz respons√°vel

  Se√ß√£o B: Partes Envolvidas

  - ‚úÖ Parte autora/principal (nome, documento, tipo)
  - ‚úÖ Parte r√©/contr√°ria (nome, documento, tipo)
  - ‚úÖ Qualifica√ß√µes

  Se√ß√£o C: Valores Financeiros

  - ‚úÖ Valor da causa
  - ‚úÖ Multas/juros
  - ‚úÖ Encargos legais
  - ‚úÖ Valor total atualizado

  Se√ß√£o D: Campos Especializados

  - ‚úÖ Execu√ß√£o fiscal (se aplic√°vel)
  - ‚úÖ A√ß√£o civil/trabalhista/previdenci√°ria/fam√≠lia

  Se√ß√£o E: Situa√ß√£o Processual

  - ‚úÖ Status atual
  - ‚úÖ √öltimos movimentos (timeline do documento)
  - ‚úÖ Pr√≥ximos passos esperados
  - ‚úÖ Prazos em aberto

  Se√ß√£o F: An√°lise Estrat√©gica

  - ‚úÖ Classifica√ß√£o de risco (ALTO/M√âDIO/BAIXO)
  - ‚úÖ Tese central
  - ‚úÖ Oportunidades
  - ‚úÖ Recomenda√ß√µes pr√°ticas

  ---
  üîÑ FLUXO SEM JUDIT (O que ocorre hoje):

  1. User faz upload de PDF
           ‚Üì
  2. Sistema extrai texto e limpa
           ‚Üì
  3. Sistema detecta CNJ (regex)
           ‚Üì
  4. Sistema cria Case no BD
           ‚Üì
  5. Sistema upload arquivo para Supabase
           ‚Üì
  6. ü§ñ GEMINI FLASH analisa documento
     ‚îú‚îÄ Extrai partes
     ‚îú‚îÄ Extrai valores
     ‚îú‚îÄ L√™ √∫ltimos movimentos
     ‚îú‚îÄ Gera resumo executivo
     ‚îî‚îÄ Calcula risco
           ‚Üì
  7. Sistema salva preview em Case.previewSnapshot
           ‚Üì
  8. Sistema salva an√°lise em CaseAnalysisVersion
           ‚Üì
  ‚úÖ RETORNA RESPOSTA COM PREVIEW COMPLETO
           ‚Üì
  9. ‚è≠Ô∏è  (OPCIONAL) Enfileira JUDIT para enriquecimento posterior

  ---
  üéõÔ∏è COMO SKIPPAR JUDIT NO UPLOAD:

  No seu frontend, ao fazer o upload, adicione o flag:

  // Frontend upload request
  const formData = new FormData();
  formData.append('file', pdfFile);
  formData.append('workspaceId', workspaceId);
  formData.append('clientId', clientId);
  formData.append('skipEnrichment', 'true'); // ‚Üê SKIPA JUDIT

  const response = await fetch('/api/process/upload', {
    method: 'POST',
    body: formData
  });

  Resultado: O processo ser√° criado com onboardingStatus: 'previewed' (n√£o 'enriching').

  ---
  üìä O QUE N√ÉO TER√Å (sem JUDIT):

  | Recurso                       | Origem                   | Impacto                                           |        
  |-------------------------------|--------------------------|---------------------------------------------------|        
  | Anexos/Documentos Oficiais    | JUDIT API                | N√£o ter√° documentos adicionados pelo tribunal     |        
  | Timeline Oficial Completa     | JUDIT API                | Ter√° apenas movimentos mencionados no PDF enviado |        
  | Hist√≥rico Processual (Portal) | JUDIT API                | N√£o sincroniza com base de dados oficial          |        
  | Auto-detec√ß√£o de Tipo         | JUDIT (pode usar Gemini) | ‚úÖ Gemini consegue detectar                        |       
  | Monitoramento em Tempo Real   | JUDIT API                | N√£o monitora atualiza√ß√µes autom√°ticas             |        

  ---
  ‚ú® PLANO PARA TESTE LIVE:

  1Ô∏è‚É£ Teste Imediato (SEM QUALQUER MUDAN√áA)

  Seu c√≥digo j√° suporta skipEnrichment=true na linha 637 do route:

  if (!skipEnrichment) {
    // Enfileira JUDIT
  }
  // Se skipEnrichment=true, isso √© pulado!

  2Ô∏è‚É£ Simule o Teste

  # Via cURL ou Postman
  curl -X POST http://localhost:3000/api/process/upload \
    -F "file=@documento.pdf" \
    -F "workspaceId=ws-123" \
    -F "clientId=cl-123" \
    -F "skipEnrichment=true"

  3Ô∏è‚É£ Verifique a Resposta

  - ‚úÖ caseId criado
  - ‚úÖ preview com an√°lise Gemini
  - ‚úÖ juditJobId: null (n√£o enfileirado)
  - ‚úÖ onboardingStatus: "previewed" (n√£o "enriching")

  ---
  üöÄ RECOMENDA√á√ïES PARA PRODU√á√ÉO:

  Op√ß√£o A: Modo "Preview-Only" (RECOMENDADO POR AGORA)

  // In route handler
  const skipEnrichment = !process.env.JUDIT_API_KEY || !isJuditEnabled;

  // O upload funcionar√° normalmente
  // Se JUDIT n√£o estiver configurada, skip automaticamente

  Op√ß√£o B: Flag de Modo Manual

  // Add env var
  JUDIT_ENRICHMENT_ENABLED=false

  // Usu√°rios veem: "Preview pronto. Enriquecimento oficial com JUDIT ser√° adicionado em breve."

  Op√ß√£o C: Fila de Retry (Melhor UX)

  // Se JUDIT fica dispon√≠vel depois:
  // User pode clicar "Sincronizar com JUDIT" e dispara enrichment
  // Reutiliza o mesmo Case, adiciona dados

  ---
  ‚úÖ CONFIRMA√á√ÉO FINAL:

  Voc√™ CONSEGUE fazer o teste live agora com:

  1. ‚úÖ Upload de PDF
  2. ‚úÖ Extra√ß√£o e limpeza de texto para "AI-friendly"
  3. ‚úÖ Envio para Gemini com system prompt
  4. ‚úÖ Retorno de resumo r√°pido
  5. ‚úÖ Preenchimento autom√°tico de:
    - Partes envolvidas
    - Valores financeiros
    - √öltimos movimentos (timeline do documento)
    - Classifica√ß√£o de risco
    - Tese central

  Tudo funciona SEM a JUDIT API KEY. O que falta √© apenas o enriquecimento com dados oficiais (attachments, timeline      
  completa, monitoramento).

  ---
  üìù Pr√≥ximos Passos (quando voc√™ me confirmar):

  1. Voc√™ quer que eu ative o modo skipEnrichment por padr√£o?
  2. Voc√™ quer adicionar uma UI/message ao usu√°rio indicando "An√°lise preview gerada, enriquecimento oficial com JUDIT    
   em breve"?
  3. Voc√™ quer que eu crie um endpoint para reprocessar com JUDIT quando a API ficar dispon√≠vel?

  Pode fazer o teste live agora! Qual √© o seu endere√ßo de produ√ß√£o para eu validar?